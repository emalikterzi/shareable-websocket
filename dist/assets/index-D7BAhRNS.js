var ne=Object.defineProperty;var re=(e,t,n)=>t in e?ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var c=(e,t,n)=>(re(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function se(e){return e&&typeof e.then=="function"}Promise.resolve(!1);var ie=Promise.resolve(!0),m=Promise.resolve();function g(e,t){return e||(e=0),new Promise(function(n){return setTimeout(function(){return n(t)},e)})}function oe(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function b(){return Math.random().toString(36).substring(2)}var M=0;function E(){var e=Date.now()*1e3;return e<=M&&(e=M+1),M=e,e}function ae(){return typeof navigator<"u"&&typeof navigator.locks<"u"&&typeof navigator.locks.request=="function"}var ue=E,ce="native";function de(e){var t={time:E(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(n){t.messagesCallback&&t.messagesCallback(n.data)},t}function le(e){e.bc.close(),e.subFns=[]}function fe(e,t){try{return e.bc.postMessage(t,!1),m}catch(n){return Promise.reject(n)}}function he(e,t){e.messagesCallback=t}function pe(){if(typeof globalThis<"u"&&globalThis.Deno&&globalThis.Deno.args)return!0;if((typeof window<"u"||typeof self<"u")&&typeof BroadcastChannel=="function"){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}else return!1}function me(){return 150}var ve={create:de,close:le,onMessage:he,postMessage:fe,canBeUsed:pe,type:ce,averageResponseTime:me,microSeconds:ue};class V{constructor(t){c(this,"ttl");c(this,"map",new Map);c(this,"_to",!1);this.ttl=t}has(t){return this.map.has(t)}add(t){this.map.set(t,W()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,_e(this)},0))}clear(){this.map.clear()}}function _e(e){const t=W()-e.ttl,n=e.map[Symbol.iterator]();for(;;){const r=n.next().value;if(!r)return;const s=r[0];if(r[1]<t)e.map.delete(s);else return}}function W(){return Date.now()}function S(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return typeof t.webWorkerSupport>"u"&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=1e3*45),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&typeof e.idb.onclose=="function"&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=1e3*60),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=1e3*60*2),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),typeof t.node.useFastPath>"u"&&(t.node.useFastPath=!0),t}var ge=E,ye="pubkey.broadcast-channel-0-",v="messages",C={durability:"relaxed"},Le="idb";function K(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function T(e){e.commit&&e.commit()}function we(e){var t=K(),n=ye+e,r=t.open(n);return r.onupgradeneeded=function(s){var i=s.target.result;i.createObjectStore(v,{keyPath:"id",autoIncrement:!0})},new Promise(function(s,i){r.onerror=function(o){return i(o)},r.onsuccess=function(){s(r.result)}})}function be(e,t,n){var r=Date.now(),s={uuid:t,time:r,data:n},i=e.transaction([v],"readwrite",C);return new Promise(function(o,d){i.oncomplete=function(){return o()},i.onerror=function(l){return d(l)};var a=i.objectStore(v);a.add(s),T(i)})}function Ee(e,t){var n=e.transaction(v,"readonly",C),r=n.objectStore(v),s=[],i=IDBKeyRange.bound(t+1,1/0);if(r.getAll){var o=r.getAll(i);return new Promise(function(a,l){o.onerror=function(p){return l(p)},o.onsuccess=function(p){a(p.target.result)}})}function d(){try{return i=IDBKeyRange.bound(t+1,1/0),r.openCursor(i)}catch{return r.openCursor()}}return new Promise(function(a,l){var p=d();p.onerror=function(f){return l(f)},p.onsuccess=function(f){var L=f.target.result;L?L.value.id<t+1?L.continue(t+1):(s.push(L.value),L.continue()):(T(n),a(s))}})}function Ie(e,t){if(e.closed)return Promise.resolve([]);var n=e.db.transaction(v,"readwrite",C),r=n.objectStore(v);return Promise.all(t.map(function(s){var i=r.delete(s);return new Promise(function(o){i.onsuccess=function(){return o()}})}))}function Ce(e,t){var n=Date.now()-t,r=e.transaction(v,"readonly",C),s=r.objectStore(v),i=[];return new Promise(function(o){s.openCursor().onsuccess=function(d){var a=d.target.result;if(a){var l=a.value;l.time<n?(i.push(l),a.continue()):(T(r),o(i))}else o(i)}})}function Me(e){return Ce(e.db,e.options.idb.ttl).then(function(t){return Ie(e,t.map(function(n){return n.id}))})}function Se(e,t){return t=S(t),we(e).then(function(n){var r={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:b(),eMIs:new V(t.idb.ttl*2),writeBlockPromise:m,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){r.closed=!0,t.idb.onclose&&t.idb.onclose()},F(r),r})}function F(e){e.closed||J(e).then(function(){return g(e.options.idb.fallbackInterval)}).then(function(){return F(e)})}function Te(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}function J(e){return e.closed||!e.messagesCallback?m:Ee(e.db,e.lastCursorId).then(function(t){var n=t.filter(function(r){return!!r}).map(function(r){return r.id>e.lastCursorId&&(e.lastCursorId=r.id),r}).filter(function(r){return Te(r,e)}).sort(function(r,s){return r.time-s.time});return n.forEach(function(r){e.messagesCallback&&(e.eMIs.add(r.id),e.messagesCallback(r.data))}),m})}function Pe(e){e.closed=!0,e.db.close()}function xe(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return be(e.db,e.uuid,t)}).then(function(){oe(0,10)===0&&Me(e)}),e.writeBlockPromise}function ke(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,J(e)}function Ne(){return!!K()}function Oe(e){return e.idb.fallbackInterval*2}var De={create:Se,close:Pe,onMessage:ke,postMessage:xe,canBeUsed:Ne,type:Le,averageResponseTime:Oe,microSeconds:ge},Re=E,Be="pubkey.broadcastChannel-",Ae="localstorage";function Q(){var e;if(typeof window>"u")return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return e}function j(e){return Be+e}function Ue(e,t){return new Promise(function(n){g().then(function(){var r=j(e.channelName),s={token:b(),time:Date.now(),data:t,uuid:e.uuid},i=JSON.stringify(s);Q().setItem(r,i);var o=document.createEvent("Event");o.initEvent("storage",!0,!0),o.key=r,o.newValue=i,window.dispatchEvent(o),n()})})}function $e(e,t){var n=j(e),r=function(i){i.key===n&&t(JSON.parse(i.newValue))};return window.addEventListener("storage",r),r}function Ve(e){window.removeEventListener("storage",e)}function We(e,t){if(t=S(t),!H())throw new Error("BroadcastChannel: localstorage cannot be used");var n=b(),r=new V(t.localstorage.removeTimeout),s={channelName:e,uuid:n,eMIs:r};return s.listener=$e(e,function(i){s.messagesCallback&&i.uuid!==n&&(!i.token||r.has(i.token)||i.data.time&&i.data.time<s.messagesCallbackTime||(r.add(i.token),s.messagesCallback(i.data)))}),s}function Ke(e){Ve(e.listener)}function Fe(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t}function H(){var e=Q();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch{return!1}return!0}function Je(){var e=120,t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?e*2:e}var Qe={create:We,close:Ke,onMessage:Fe,postMessage:Ue,canBeUsed:H,type:Ae,averageResponseTime:Je,microSeconds:Re},q=E,je="simulate",P=new Set;function He(e){var t={time:q(),name:e,messagesCallback:null};return P.add(t),t}function qe(e){P.delete(e)}var X=5;function Xe(e,t){return new Promise(function(n){return setTimeout(function(){var r=Array.from(P);r.forEach(function(s){s.name===e.name&&s!==e&&s.messagesCallback&&s.time<t.time&&s.messagesCallback(t)}),n()},X)})}function Ge(e,t){e.messagesCallback=t}function ze(){return!0}function Ye(){return X}var Ze={create:He,close:qe,onMessage:Ge,postMessage:Xe,canBeUsed:ze,type:je,averageResponseTime:Ye,microSeconds:q},N=[ve,De,Qe];function et(e){var t=[].concat(e.methods,N).filter(Boolean);if(e.type){if(e.type==="simulate")return Ze;var n=t.find(function(s){return s.type===e.type});if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter(function(s){return s.type!=="idb"}));var r=t.find(function(s){return s.canBeUsed()});if(r)return r;throw new Error("No usable method found in "+JSON.stringify(N.map(function(s){return s.type})))}var G=new Set,tt=0,x=function(t,n){this.id=tt++,G.add(this),this.name=t,O&&(n=O),this.options=S(n),this.method=et(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,nt(this)};x._pubkey=!0;var O;x.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(t));return D(this,"message",t)},postInternal:function(t){return D(this,"internal",t)},set onmessage(e){var t=this.method.microSeconds(),n={time:t,fn:e};B(this,"message",this._onML),e&&typeof e=="function"?(this._onML=n,R(this,"message",n)):this._onML=null},addEventListener:function(t,n){var r=this.method.microSeconds(),s={time:r,fn:n};R(this,t,s)},removeEventListener:function(t,n){var r=this._addEL[t].find(function(s){return s.fn===n});B(this,t,r)},close:function(){var t=this;if(!this.closed){G.delete(this),this.closed=!0;var n=this._prepP?this._prepP:m;return this._onML=null,this._addEL.message=[],n.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(r){return r()}))}).then(function(){return t.method.close(t._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};function D(e,t,n){var r=e.method.microSeconds(),s={time:r,type:t,data:n},i=e._prepP?e._prepP:m;return i.then(function(){var o=e.method.postMessage(e._state,s);return e._uMP.add(o),o.catch().then(function(){return e._uMP.delete(o)}),o})}function nt(e){var t=e.method.create(e.name,e.options);se(t)?(e._prepP=t,t.then(function(n){e._state=n})):e._state=t}function z(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function R(e,t,n){e._addEL[t].push(n),rt(e)}function B(e,t,n){e._addEL[t]=e._addEL[t].filter(function(r){return r!==n}),st(e)}function rt(e){if(!e._iL&&z(e)){var t=function(s){e._addEL[s.type].forEach(function(i){s.time>=i.time&&i.fn(s.data)})},n=e.method.microSeconds();e._prepP?e._prepP.then(function(){e._iL=!0,e.method.onMessage(e._state,t,n)}):(e._iL=!0,e.method.onMessage(e._state,t,n))}}function st(e){if(e._iL&&!z(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}function it(e){if(typeof WorkerGlobalScope=="function"&&self instanceof WorkerGlobalScope){var t=self.close.bind(self);self.close=function(){return e(),t()}}else{if(typeof window.addEventListener!="function")return;window.addEventListener("beforeunload",function(){e()},!0),window.addEventListener("unload",function(){e()},!0)}}function ot(e){process.on("exit",function(){return e()}),process.on("beforeExit",function(){return e().then(function(){return process.exit()})}),process.on("SIGINT",function(){return e().then(function(){return process.exit()})}),process.on("uncaughtException",function(t){return e().then(function(){console.trace(t),process.exit(101)})})}var at=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",ut=at?ot:it,w=new Set,A=!1;function ct(){A||(A=!0,ut(lt))}function dt(e){if(ct(),typeof e!="function")throw new Error("Listener is no function");w.add(e);var t={remove:function(){return w.delete(e)},run:function(){return w.delete(e),e()}};return t}function lt(){var e=[];return w.forEach(function(t){e.push(t()),w.delete(t)}),Promise.all(e)}function y(e,t){var n={context:"leader",action:t,token:e.token};return e.broadcastChannel.postInternal(n)}function Y(e){e.isLeader=!0,e._hasLeader=!0;var t=dt(function(){return e.die()});e._unl.push(t);var n=function(s){s.context==="leader"&&s.action==="apply"&&y(e,"tell"),s.context==="leader"&&s.action==="tell"&&!e._dpLC&&(e._dpLC=!0,e._dpL(),y(e,"tell"))};return e.broadcastChannel.addEventListener("internal",n),e._lstns.push(n),y(e,"tell")}var Z=function(t,n){var r=this;this.broadcastChannel=t,t._befC.push(function(){return r.die()}),this._options=n,this.isLeader=!1,this.isDead=!1,this.token=b(),this._lstns=[],this._unl=[],this._dpL=function(){},this._dpLC=!1,this._wKMC={},this.lN="pubkey-bc||"+t.method.type+"||"+t.name};Z.prototype={hasLeader:function(){var t=this;return navigator.locks.query().then(function(n){var r=n.held?n.held.filter(function(s){return s.name===t.lN}):[];return!!(r&&r.length>0)})},awaitLeadership:function(){var t=this;if(!this._wLMP){this._wKMC.c=new AbortController;var n=new Promise(function(r,s){t._wKMC.res=r,t._wKMC.rej=s});this._wLMP=new Promise(function(r){navigator.locks.request(t.lN,{signal:t._wKMC.c.signal},function(){return t._wKMC.c=void 0,Y(t),r(),n}).catch(function(){})})}return this._wLMP},set onduplicate(e){},die:function(){var t=this;return this._lstns.forEach(function(n){return t.broadcastChannel.removeEventListener("internal",n)}),this._lstns=[],this._unl.forEach(function(n){return n.remove()}),this._unl=[],this.isLeader&&(this.isLeader=!1),this.isDead=!0,this._wKMC.res&&this._wKMC.res(),this._wKMC.c&&this._wKMC.c.abort("LeaderElectionWebLock.die() called"),y(this,"death")}};var ee=function(t,n){var r=this;this.broadcastChannel=t,this._options=n,this.isLeader=!1,this._hasLeader=!1,this.isDead=!1,this.token=b(),this._aplQ=m,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var s=function(o){o.context==="leader"&&(o.action==="death"&&(r._hasLeader=!1),o.action==="tell"&&(r._hasLeader=!0))};this.broadcastChannel.addEventListener("internal",s),this._lstns.push(s)};ee.prototype={hasLeader:function(){return Promise.resolve(this._hasLeader)},applyOnce:function(t){var n=this;if(this.isLeader)return g(0,!0);if(this.isDead)return g(0,!1);if(this._aplQC>1)return this._aplQ;var r=function(){if(n.isLeader)return ie;var i=!1,o,d=new Promise(function(p){o=function(){i=!0,p()}}),a=function(f){f.context==="leader"&&f.token!=n.token&&(f.action==="apply"&&f.token>n.token&&o(),f.action==="tell"&&(o(),n._hasLeader=!0))};n.broadcastChannel.addEventListener("internal",a);var l=t?n._options.responseTime*4:n._options.responseTime;return y(n,"apply").then(function(){return Promise.race([g(l),d.then(function(){return Promise.reject(new Error)})])}).then(function(){return y(n,"apply")}).then(function(){return Promise.race([g(l),d.then(function(){return Promise.reject(new Error)})])}).catch(function(){}).then(function(){return n.broadcastChannel.removeEventListener("internal",a),i?!1:Y(n).then(function(){return!0})})};return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then(function(){return r()}).then(function(){n._aplQC=n._aplQC-1}),this._aplQ.then(function(){return n.isLeader})},awaitLeadership:function(){return this._aLP||(this._aLP=ft(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var t=this;return this._lstns.forEach(function(n){return t.broadcastChannel.removeEventListener("internal",n)}),this._lstns=[],this._unl.forEach(function(n){return n.remove()}),this._unl=[],this.isLeader&&(this._hasLeader=!1,this.isLeader=!1),this.isDead=!0,y(this,"death")}};function ft(e){return e.isLeader?m:new Promise(function(t){var n=!1;function r(){n||(n=!0,e.broadcastChannel.removeEventListener("internal",i),t(!0))}e.applyOnce().then(function(){e.isLeader&&r()});var s=function o(){return g(e._options.fallbackInterval).then(function(){if(!(e.isDead||n))if(e.isLeader)r();else return e.applyOnce(!0).then(function(){e.isLeader?r():o()})})};s();var i=function(d){d.context==="leader"&&d.action==="death"&&(e._hasLeader=!1,e.applyOnce().then(function(){e.isLeader&&r()}))};e.broadcastChannel.addEventListener("internal",i),e._lstns.push(i)})}function ht(e,t){return e||(e={}),e=JSON.parse(JSON.stringify(e)),e.fallbackInterval||(e.fallbackInterval=3e3),e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options)),e}function pt(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=ht(t,e);var n=ae()?new Z(e,t):new ee(e,t);return e._befC.push(function(){return n.die()}),e._leaderElector=n,n}var mt=class extends EventTarget{dispatchTypedEvent(e,t){return super.dispatchEvent(t)}};let I;const vt=new Uint8Array(16);function _t(){if(!I&&(I=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!I))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return I(vt)}const u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));function gt(e,t=0){return u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]}const yt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),U={randomUUID:yt};function te(e,t,n){if(U.randomUUID&&!t&&!e)return U.randomUUID();e=e||{};const r=e.random||(e.rng||_t)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(let s=0;s<16;++s)t[n+s]=r[s];return t}return gt(r)}function h(){}const _={UPDATE_CONTEXT:"UPDATE_CONTEXT",INSTANCE_REMOVED:"INSTANCE_REMOVED",INSTANCE_JOIN:"INSTANCE_JOIN",EVENT_LISTENER:"EVENT_LISTENER"},$={namespace:"__sharedTabsContext"};class Lt extends mt{constructor(n=$,r={fallbackInterval:2e3,responseTime:1e3},s={type:"native"}){super();c(this,"_instanceId",te());c(this,"channel");c(this,"elector");c(this,"_isReady");c(this,"_context");const i={...n,...$};this._context=Object.create({}),this.channel=new x(i.namespace,s),this.elector=pt(this.channel,r),this.channel.onmessage=o=>this.onMessage(o),this._isReady=this.elector.hasLeader(),this.elector.awaitLeadership().then(()=>this.onMasterSelection().then(h).catch(h)),this._isReady.then(()=>this.publishInternal(_.INSTANCE_JOIN)),window.addEventListener("beforeunload",()=>this.publishInternal(_.INSTANCE_REMOVED))}putContext(n,r){this._context[n]=r}publishContext(){this.publishInternal(_.UPDATE_CONTEXT,this._context)}publishInternal(n,r){this.channel.postMessage({instanceId:this._instanceId,action:n,msg:r}).then(h).catch(h)}async onUpdateContextEvent(n,r){}async onInstanceRemoved(n){}async onEventListener(n){}async onMessage(n){switch(n.action){case _.UPDATE_CONTEXT:this.onUpdateContextEvent(n.instanceId,n.msg).then(h).catch(h);break;case _.INSTANCE_REMOVED:this.onInstanceRemoved(n.instanceId).then(h).catch(h);break;case _.INSTANCE_JOIN:this.publishContext();break;case _.EVENT_LISTENER:this.onEventListener(n).then(h).catch(h);break}}async onMasterSelection(){console.log("instance id selected master: ",this._instanceId)}isReady(){return this._isReady}get instanceId(){return this._instanceId}get context(){return this._context}}const wt=e=>({get(t,n,r){if(n==="addEventListener")return function(s,i,o){const d={key:s,listener:i,options:o,target:t,receiver:r,subscriptionId:te()},a=o;return a&&a.signal&&(d.signal=a.signal),e._createAddListener(d),console.log(t),t.addEventListener(s,i,o)};throw new Error("Cannot use method With Shared Tabs: "+n.toString())}});class k{constructor(t){c(this,"context");this.context=t}addSubscription(t,n){const r=this.context.subscriptions||(this.context.subscriptions={}),s=r[t]||(r[t]=[]);s.includes(n)||s.push(n)}removeSubscription(t,n){const r=this.context.subscriptions||(this.context.subscriptions={}),s=r[t]||(r[t]=[]);s.splice(s.indexOf(n),1)}static from(t){return new k(t)}}class bt extends EventTarget{}class Et extends Lt{constructor(n,r,s,i){super(r,s,i);c(this,"proxy");c(this,"proxyInstance");c(this,"clusterContext",{});c(this,"source");c(this,"listeners",{});this.webSocketOptions=n,this.proxyInstance=new bt,this.proxy=new Proxy(this.proxyInstance,wt(this)),setInterval(()=>{},2e3)}async onMasterSelection(){this.source=new WebSocket(this.webSocketOptions.url),this.source.addEventListener("message",n=>{const r=new MessageEvent(n.type,{lastEventId:n.lastEventId,data:n.data,source:n.source,origin:n.origin});this.publishInternal(_.EVENT_LISTENER,{type:n.type,data:n.data}),this.proxyInstance.dispatchEvent(r)})}async onEventListener(n){const r=n.msg.type;if(r==="message"){const s=new MessageEvent(r,{data:n.msg.data});this.proxyInstance.dispatchEvent(s)}}async onUpdateContextEvent(n,r){this.clusterContext[n]=r}async onInstanceRemoved(n){delete this.clusterContext[n]}getConnection(){return this.proxy}_createAddListener(n){const r=k.from(this.context),s=this.listeners[n.key]||(this.listeners[n.key]=[]),i=s.find(o=>o.listener==n.listener);i&&(r.removeSubscription(i.key,i.subscriptionId),s.splice(s.indexOf(i),1)),r.addSubscription(n.key,n.subscriptionId),s.push(n),this.publishContext()}}async function It(){const e=new Et({url:"ws://localhost:8282"},{namespace:"hello"});await e.isReady();function t(n){console.log(n)}e.getConnection().addEventListener("message",t)}It();
